-- Refunds for the payments that were proccessed back in April but were not recorded in database
-- Expected quantity of payments to be created: 152

BEGIN;

-- Retrieve the original payment data
WITH original_payments_data AS (SELECT id,
                                       account_id,
                                       payment_type_id,
                                       payment_status_id,
                                       payment_method_id,
                                       payment_gateway_id,
                                       external_ref_id,
                                       amount
                                FROM billing.payments
                                WHERE id IN (
                                             '9bcfd6b1-faf1-4f0e-ac18-aeae595161c3',
                                             '9bc3c54b-3158-4e27-ad31-f3280b1cf893',
                                             '9bc5c7fc-4577-400b-8c78-911f3708c4b9',
                                             '9bb9b23b-df80-4bb7-95ba-d73b0dbd0bf2',
                                             '9bbbb89f-aa5c-457a-a7d8-04e249c0b72e',
                                             '9bc3c401-c1a9-471c-83c0-be4c2ed38ab4',
                                             '9bbbc230-ee88-4c87-9e50-50f4bdbd8d37',
                                             '9bc7cb8f-062c-4ed6-ac76-7bd2a60d20fb',
                                             '9bbdbb52-1cd3-4cb1-9847-af204313a3d9',
                                             '9bc9cce8-e66c-45e9-b972-15994c2d0973',
                                             '9bc3c454-cf00-4785-9d54-5b4280b5ca3c',
                                             '9bc5c79d-d70e-4f64-8cc4-25b2a2904811',
                                             '9bcdd8fe-edf9-4237-8e3f-d5f251958279',
                                             '9bc7ca3e-03ea-4e73-936d-8f7f5224831f',
                                             '9bc7ca5f-46e5-4b06-a100-64756fe7805f',
                                             '9bcbd11a-33c7-4623-9748-7d4496df786f',
                                             '9bc3c45a-aaf1-4b3d-9863-7ac4361ee93f',
                                             '9bc5c8a7-a82a-4576-bf39-020a62c1b453',
                                             '9bbbc393-e487-4f28-afa2-7b4105eed2c1',
                                             '9bc7ca64-7337-4df0-ad55-6510e6f4cf33',
                                             '9bbbb96c-6309-4d95-beb8-d690e0dc1eaa',
                                             '9bc7cba6-52ae-4928-8183-dc293235858b',
                                             '9bc9cd27-fbb7-47e9-bf20-5f8072fed882',
                                             '9bc5c8ce-2177-42db-99f4-51b0e3b5625a',
                                             '9bbbb873-425e-42ef-9f51-2015e658d840',
                                             '9bbbc154-7b13-4013-8831-12796cd434a1',
                                             '9bc5c705-f0ae-4b8f-8e33-e7a615a8c447',
                                             '9bbbc0a9-38b4-4204-ba05-80022a8a0134',
                                             '9bb9b293-ba79-46c0-98fb-09978130ccf5',
                                             '9bbbb888-75f1-4411-b983-8a0586a74767',
                                             '9bcddb60-a2e6-4ef0-bb7b-b46a7f2d59b6',
                                             '9bbfbe46-fe72-4522-ba8a-176592c2cb05',
                                             '9bbbc24e-73f3-4815-9f9d-c21b1171cc43',
                                             '9bc5c8c8-aa27-4915-842f-d0e1d41e301a',
                                             '9bbbb90f-20f2-4e02-8b4a-9bb6b2dae7e8',
                                             '9bcbd110-5d49-4df7-98d2-74b99a24fe3c',
                                             '9bbdbbad-e938-4ea0-9061-ecc2a591c65a',
                                             '9bb7af86-9c2a-4584-9c50-8e601867ab96',
                                             '9bc5c7bb-cb9a-4b42-ab73-5f3c19b19b22',
                                             '9bcbd937-c316-49a0-b472-c328f2bbd104',
                                             '9bc9ce81-4eb1-44c8-84f2-a9671a31b702',
                                             '9bc7caa7-9acd-4303-8614-a7ef3ac490d7',
                                             '9bc5c8d2-9390-4d64-b833-fb64101c4f99',
                                             '9bc3c53f-a797-4e00-98f6-2b9fd5386a46',
                                             '9bcbd7a7-e80a-4cdc-b08c-63095e5c1544',
                                             '9bcddc42-e849-4df2-acf7-3805514d53da',
                                             '9ba1919d-98e6-4dc7-a0a0-d809326c9aae',
                                             '9bbbc2b0-6230-4a3d-94f9-2acf2378a3f4',
                                             '9bcbd173-af31-40c1-8119-814a8bf901ca',
                                             '9bcbd560-0d67-4111-a46f-2a3a60b613ea',
                                             '9bcddba9-900d-49c0-85d6-e3ebac56249d',
                                             '9bc5c823-110d-43ae-9ba9-5f323ed49cc2',
                                             '9ba3919a-ecec-4faa-8366-fb69ac0007f0',
                                             '9bbfbe0d-f25d-4ed0-a2e9-90736a7e1c05',
                                             '9bbbb95e-8353-4acd-969e-c65bdcd3a320',
                                             '9bbbb966-7867-4a20-9c09-e8abac2aa686',
                                             '9b9d8279-2e5d-4cae-ae4a-c7111c07fb81',
                                             '9bcbd0dd-22b3-4ec7-96ee-045f8c07843b',
                                             '9bbbb8b8-1e67-44e6-9964-69e0e3fae8de',
                                             '9bc9ceb0-08e7-40ad-a034-57bec0d022e2',
                                             '9bbbc224-eaed-4c3a-a87a-5855296b05bf',
                                             '9bcbd6b3-4e61-4e85-bcb6-c4038ec77a99',
                                             '9bcbd893-0024-4753-ae45-aa50f1d59303',
                                             '9bcddc55-a3f4-40df-aa7d-c7b9d0d5308b',
                                             '9bc3c543-5eba-451e-b65f-384122880ae6',
                                             '9bcdd2d2-5dad-4ff8-8f7d-21af02c9f958',
                                             '9bc3c51c-7872-4300-9716-7516dcadc4c1',
                                             '9bc1c0b9-ce1c-4178-988d-f4173bc2ebc6',
                                             '9bbbc461-9c70-4277-8907-4eb047519057',
                                             '9bcdd460-8e3f-44b6-8006-f1482fdffd13',
                                             '9bbbc0fb-89db-4096-9c67-e93dae31def6',
                                             '9bbdbb8f-808e-45a6-a849-3cef9993b629',
                                             '9bcbd762-8399-4929-9a3c-64a279d6971f',
                                             '9bcddb6d-5da5-4d1c-9615-93503ff89c57',
                                             '9bbbc2a8-87db-452f-aacc-913bf9051717',
                                             '9bc7cb88-b9f0-4e30-a7b6-12090cf15cfb',
                                             '9bcbd5c3-cf77-41e8-ad30-1d0ee213a487',
                                             '9bcdd9d8-b28d-409c-b84b-ae23f741123c',
                                             '9bc3c405-4b33-4db1-a87c-10e83e6e461d',
                                             '9bcbd077-1d52-4bf2-a403-e504e4d0d886',
                                             '9ba191b9-01d1-4ef4-8dd0-cdc9702d73c4',
                                             '9bcbd7ad-641b-49ca-a365-b2092c69ca73',
                                             '9bcddd5d-36fd-4574-a9be-8266857a2d56',
                                             '9ba99a6b-9dd7-420d-b7d4-7af102f14f57',
                                             '9bcddc1d-cc31-4c0b-b033-ab02369d1d01',
                                             '9bc3c53b-c74a-465a-b8cf-9fb33229054e',
                                             '9bc3c469-4e8c-4db3-888f-7db7484c8a83',
                                             '9bc5c857-7073-4465-b871-0db3b43b031f',
                                             '9bc7cab9-b88c-4ae6-a6c0-8b641159c581',
                                             '9bc3c55f-1b3a-4d76-9d89-5781d385b48b',
                                             '9bc3c552-abe8-426f-b28e-185d4ecd4ab0',
                                             '9bc9ce74-5f63-4ca6-b4bd-f67f4d9838f4',
                                             '9bc3c5ad-45d0-43d8-8a66-04dc4f543cac',
                                             '9bc5c8c4-7eeb-493d-b49d-429fe029d534',
                                             '9bc3c46f-6fc9-4dc9-b6b7-e6f572eafb7c',
                                             '9bc3c4a8-d141-45c5-b5b0-57e189b5f39e',
                                             '9bc3c504-0cef-478d-ba88-04d9bd68b4d7',
                                             '9bc3c430-34bb-4275-9b61-0a75e9476068',
                                             '9bc5c880-4871-4b44-a3b9-3ce2d437a61a',
                                             '9bbbbfbc-0b57-49fd-a4fd-67f033ded040',
                                             '9bc5c853-d018-4376-ac76-1c87c9a0b2d3',
                                             '9bbbc341-d27d-40ed-a9d9-e94d0b915998',
                                             '9bbdbba0-5572-495f-aad0-6d8db0bc3418',
                                             '9bbbc405-820a-4ddc-9ec7-1daf0ad4ce55',
                                             '9bc7ca90-260f-4760-8563-17704909d2ed',
                                             '9bc9ce68-94ae-4b77-a44e-a01be6d337ab',
                                             '9bcbd123-1c32-4253-b011-4f8191a44a2b',
                                             '9bcbcfc9-45dc-43e5-9d91-de25d623cfb0',
                                             '9bbbc2e5-306f-42c8-aa87-02e99ca3a351',
                                             '9bcbd72c-468c-4cbc-893b-5795d4e3ea09',
                                             '9bbbc454-2369-4816-aab8-bb17715fdbdf',
                                             '9bc5c76c-2872-4c6f-bf49-23f288921471',
                                             '9bbfbee4-5027-4495-b3ef-df873adca260',
                                             '9bb7af98-f9da-4479-abfd-9a26052a5da2',
                                             '9bcddcda-10db-43af-879d-e81bbb1940d6',
                                             '9bcbd6f0-f8b5-408f-b5bd-6d34a7aa9287',
                                             '9bcbd692-3214-4614-b622-7010db872789',
                                             '9bcdd37c-b01c-4da3-9dbc-0ce65f55bc63',
                                             '9bbbc4f9-29e9-46ec-8caf-1aba7689f295',
                                             '9bbbc42f-c859-4242-9e6d-deeae7e74d17',
                                             '9bc5c764-1f0a-4015-acc8-743b703f3017',
                                             '9bcddc23-ef05-4e42-b789-d304ed586b96',
                                             '9bbbc444-6927-4273-b5ed-dbffe8a52240',
                                             '9bc5c80b-3c9b-49e5-b79e-69f7ff851d49',
                                             '9bcbd8fb-1a22-495c-b9a1-672833d465e5',
                                             '9bcdd3c4-f3e9-4a5e-8699-24bf2bb4a66d',
                                             '9bcfd735-a2b4-46c0-b2ee-b8e83a42c4cf',
                                             '9bbbc3e5-0695-4944-9f05-b29ebbb156af',
                                             '9bbdbc54-0023-41bd-b529-86db9320564a',
                                             '9bcbd94d-c2b1-4294-91fe-2268a1499c00',
                                             '9bcbd14f-dc40-4a8c-a559-909c5cb92049',
                                             '9ba99a52-8a5f-4b67-848f-fe5a976dc489',
                                             '9bbbc195-2b8b-4e82-b880-6d7f9655a353',
                                             '9bcddd09-34a4-4a43-9daf-e6ca236a79d4',
                                             '9bbbc3a9-8fa0-4d93-927c-53db86e58d6f',
                                             '9bcdd3d7-0c3e-4d2a-a480-d8655551c162',
                                             '9bbbc130-fdaa-4a8c-844b-392c42057c59',
                                             '9bbfbdf0-6a9a-434b-864b-aa70d3c3e890',
                                             '9bbfbf28-7062-41c7-9b24-4bd5ce55db56',
                                             '9bc5c89f-e492-48d6-ba05-ee5b9686cf6c',
                                             '9bc9cde4-3988-4480-a5a3-5fe5ca15a2ed',
                                             '9bc5c84d-2968-440e-b07d-ace96815fa7b',
                                             '9bcdd973-9bb5-45f2-acc7-9ac0150ac2a3',
                                             '9bcddac0-924a-483c-a923-8455ea39804c',
                                             '9bcddae5-cb73-42b8-9176-4d2bf52fc645',
                                             '9bcddcbf-3dab-4a14-a0ef-89e6333d82c1',
                                             '9bc7ca32-edf5-4914-ad40-c093c083bba9',
                                             '9bbdbc58-45dc-4ed5-917d-43e8057a0cd8',
                                             '9bc3c434-5d9f-464a-b024-5f8bff53c388',
                                             '9bc5c89a-a8c4-4878-9430-1f2f1d724032',
                                             '9bcdd3cf-e5a1-450e-ba5f-7d7604e78d9d',
                                             '9bbbc1f8-53c5-4ca3-8f95-97240a51b94c'
                                    ))
-- Insert the refund records (status_id = 9 is 'Credited', we are using 30th April 2024 as the processed date)
INSERT
INTO billing.payments (account_id,
                       payment_type_id,
                       payment_status_id,
                       payment_method_id,
                       payment_gateway_id,
                       amount,
                       notes,
                       processed_at,
                       original_payment_id,
                       pestroutes_original_payment_id,
                       pestroutes_refund_processed_at,
                       pestroutes_created_by_crm,
                       external_ref_id)
SELECT account_id                                                   AS account_id,
       payment_type_id                                              AS payment_type_id,
       9                                                            AS payment_status_id,
       payment_method_id                                            AS payment_method_id,
       payment_gateway_id                                           AS payment_gateway_id,
       amount                                                       AS amount,
       CONCAT('Historical record of refund for April payment ', id) AS notes,
       '2024-04-30 00:00:00'::TIMESTAMP                             AS processed_at, -- consider this as the date when the refund was processed
       id                                                           AS original_payment_id,
       external_ref_id                                              AS pestroutes_original_payment_id,
       '2024-04-30 00:00:00'::TIMESTAMP                             AS pestroutes_refund_processed_at, -- set the same date as the processed_at so it won't be proccesed by payment service later
       TRUE                                                         AS pestroutes_created_by_crm,
       1000000000 + external_ref_id                                 AS external_ref_id -- fake external_ref_id so it won't be synced right away
FROM original_payments_data;

COMMIT;